<!doctype html>
<html langs"en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<link rel="icon" href="/public/images/icon.png" type="image/x-icon">
<title>Wordlink</title>
<style>
  :root{
    --bg: #ffffff;
    --muted: #f1f5f9;
    --accent: #0A84FF;
    --accent-hover: #0070e0;
    --text: #0f172a;
    --text-muted: #64748b;
    --border: rgba(15,23,42,0.08);
    --glow: rgba(10,132,255,0.15);
    font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
  
  .frame{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    padding:0;
    max-width:100%;
  }
  
  .phone{
    width:100%;
    max-width:100%;
    background:var(--bg);
    padding:20px;
    flex:1;
  }

  .header{
    display:flex;
    gap:14px;
    align-items:center;
    margin-bottom:24px;
    padding-bottom:20px;
    border-bottom:1px solid var(--border);
    max-width:600px;
    margin-left:auto;
    margin-right:auto;
  }
  
  .avatar{
    width:48px;
    height:48px;
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:black;
    font-weight:700;
    font-size:18px;
    cursor:pointer;
    transition:all 0.2s;
  }
  
  .avatar:hover{
    transform:translateY(-2px);
  }

  
  .header-content{
    flex:1;
  }
  
  .header-title{
    font-weight:700;
    font-size:16px;
    margin-bottom:2px;
    color:var(--text);
  }
  
  .header-subtitle{
    font-size:11px;
    color:var(--text-muted);
  }
  
  .menu-btn{
    width:40px;
    height:40px;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.2s;
  }
  
  .menu-btn:hover{
    transform:translateY(-2px);
  }

  .content{
    max-width:600px;
    margin:0 auto;
    width:100%;
  }

  .title{
    font-size:14px;
    font-weight:600;
    margin-bottom:12px;
    color:var(--text);
  }

  textarea{
    width:100%;
    min-height:44px;
    max-height:200px;
    resize:none;
    border-radius:12px;
    border:1px solid var(--border);
    background:var(--muted);
    padding:12px 16px;
    font-size:14px;
    line-height:1.5;
    outline:none;
    color:var(--text);
    transition:all 0.3s;
    overflow:hidden;
  }
  
  textarea::placeholder{
    color:var(--text-muted);
  }
  
  textarea:focus{
    border-color:var(--accent);
    box-shadow: 0 0 0 4px var(--glow);
    background:#fff;
  }

  .image-zone{
    margin:20px 0;
    position:relative;
  }
  
  .file-input{
    position:absolute;
    opacity:0;
    width:100%;
    height:100%;
    cursor:pointer;
    z-index:2;
    top:0;
    left:0;
    pointer-events:none;
  }
  
  .file-input.active{
    pointer-events:auto;
  }

  .add-box{
    width:100%;
    min-height:280px;
    max-height:500px;
    border-radius:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:16px;
    border:2px dashed var(--border);
    background:var(--muted);
    transition:all 0.3s;
    cursor:pointer;
    position:relative;
    overflow:hidden;
  }
  
  .add-box.has-image{
    border:1px solid var(--border);
    padding:0;
    height:auto;
    display:flex;
    align-items:center;
  }
  
  .preview-image{
    width:100%;
    height:auto;
    max-height:500px;
    object-fit:cover;
    object-position:center;
    border-radius:18px;
    display:none;
  }
  
  .preview-image.show{
    display:block;
  }
  
  .upload-content.hide{
    display:none;
  }
  
  .upload-content{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:16px;
    width:100%;
    height:100%;
    position:absolute;
    top:0;
    left:0;
  }
  
  .add-box::before{
    content:'';
    position:absolute;
    inset:0;
    background:linear-gradient(135deg, rgba(10,132,255,0.03), rgba(10,132,255,0.08));
    opacity:0;
    transition:opacity 0.3s;
  }
  
  .image-zone:hover .add-box::before{
    opacity:1;
  }
  
  .image-zone:hover .add-box{
    border-color:var(--accent);
    transform:translateY(-2px);
    box-shadow:0 12px 32px rgba(10,132,255,0.15);
  }

  .plus{
    width:64px;
    height:64px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--accent) 0%, #0070e0 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-weight:700;
    font-size:28px;
    box-shadow:0 8px 24px rgba(10,132,255,0.3);
    position:relative;
    z-index:1;
    transition:transform 0.3s;
  }
  
  .image-zone:hover .plus{
    transform:scale(1.2);
  }
  
  .add-text{
    font-size:13px;
    font-weight:600;
    color:var(--text);
    position:relative;
    z-index:1;
  }
  
  .add-subtext{
    font-size:11px;
    color:var(--text-muted);
    position:relative;
    z-index:1;
  }
  
  .remove-btn{
    position:absolute;
    top:12px;
    right:12px;
    width:36px;
    height:36px;
    border-radius:50%;
    background:rgba(0,0,0,0.6);
    backdrop-filter:blur(10px);
    display:none;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:20px;
    cursor:pointer;
    z-index:20;
    transition:all 0.2s;
    border:none;
  }
  
  .remove-btn.show{
    display:flex;
  }
  
  .remove-btn:hover{
    background:rgba(0,0,0,0.8);
    transform:scale(1.1);
  }
  
  /* Modal Styles */
  .modal-overlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    backdrop-filter:blur(4px);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
    animation:fadeIn 0.2s ease;
  }
  
  .modal-overlay.show{
    display:flex;
  }
  
  @keyframes fadeIn{
    from{opacity:0}
    to{opacity:1}
  }
  
  .modal{
    background:var(--bg);
    border-radius:20px;
    padding:28px;
    max-width:400px;
    width:90%;
    box-shadow:0 20px 60px rgba(0,0,0,0.3);
    animation:slideUp 0.3s ease;
  }
  
  @keyframes slideUp{
    from{transform:translateY(20px);opacity:0}
    to{transform:translateY(0);opacity:1}
  }
  
  .modal-title{
    font-size:18px;
    font-weight:700;
    color:var(--text);
    margin-bottom:12px;
  }
  
  .modal-message{
    font-size:14px;
    color:var(--text-muted);
    margin-bottom:24px;
    line-height:1.6;
  }
  
  .modal-actions{
    display:flex;
    gap:12px;
  }
  
  .modal-btn{
    flex:1;
    padding:12px 20px;
    border-radius:12px;
    font-weight:600;
    font-size:14px;
    cursor:pointer;
    transition:all 0.2s;
    border:none;
  }
  
  .modal-btn.cancel{
    background:var(--muted);
    color:var(--text);
  }
  
  .modal-btn.cancel:hover{
    background:#e2e8f0;
  }
  
  .modal-btn.confirm{
    background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color:#fff;
    box-shadow:0 8px 20px rgba(239,68,68,0.25);
  }
  
  .modal-btn.confirm:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 28px rgba(239,68,68,0.35);
  }

  .controls{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-top:20px;
  }
  
  .left-icons{
    display:flex;
    gap:8px;
    align-items:center;
  }
  
  .icon{
    width:44px;
    height:44px;
    border-radius:12px;
    background:var(--muted);
    border:1px solid var(--border);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:16px;
    cursor:pointer;
    transition:all 0.2s;
  }
  .icon:hover{
    border-color:var(--accent);
    transform:translateY(-2px);
  }
  
  .post-btn{
    background:linear-gradient(135deg, var(--accent) 0%, #0070e0 100%);
    color:#fff;
    border:none;
    padding:14px 28px;
    border-radius:14px;
    font-weight:600;
    font-size:14px;
    cursor:pointer;
    box-shadow:0 8px 24px rgba(10,132,255,0.25);
    transition:all 0.2s;
    position:relative;
    overflow:hidden;
  }
  
  .post-btn::before{
    content:'';
    position:absolute;
    inset:0;
    background:linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
    opacity:0;
    transition:opacity 0.2s;
  }
  
  .post-btn:hover::before{
    opacity:1;
  }
  
  .post-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 32px rgba(10,132,255,0.35);
  }
  
  .post-btn:active{
    transform:translateY(0);
  }
  
  /* Tablet */
  @media (min-width:641px) and (max-width:1024px){
    .phone{padding:32px}
    .content{max-width:700px}
    .header{max-width:700px}
    .add-box{min-height:320px;max-height:550px}
    .plus{width:68px;height:68px;font-size:30px}
    textarea{font-size:14px}
    .header-title{font-size:17px}
    .title{font-size:15px}
  }
  
  /* Laptop/Desktop */
  @media (min-width:1025px){
    .phone{padding:40px}
    .content{max-width:800px}
    .header{max-width:800px}
    .add-box{min-height:360px;max-height:600px}
    .plus{width:72px;height:72px;font-size:32px}
    textarea{font-size:15px;min-height:50px}
    .header-title{font-size:18px}
    .header-subtitle{font-size:12px}
    .title{font-size:16px}
    .add-text{font-size:14px}
    .add-subtext{font-size:12px}
    .post-btn{padding:14px 36px;font-size:15px}
    .icon{width:48px;height:48px;font-size:18px}
  }
  
  /* Mobile */
  @media (max-width:640px){
    .phone{padding:16px}
  }
</style>
</head>
<body>
  <div class="frame">
    <div class="phone">
      <div class="header">
        <div class="avatar" onclick="showExitModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </div>
        <div class="header-content">
          <div class="header-title">Create Post</div>
          <div class="header-subtitle">Share your thoughts</div>
        </div>
        <div class="menu-btn">
        </div>
      </div>

      <div class="content">
        <div class="title">What's on your mind?</div>
        <textarea id="autoExpand" placeholder="What's happening.." oninput="autoResize(this)"></textarea>

        <div class="image-zone">
          <input type="file" accept="image/*,video/*" class="file-input active" id="fileInput" onchange="handleFileSelect(event)">
          <div class="add-box" id="addBox">
            <img id="previewImage" class="preview-image" alt="Preview">
            <div class="upload-content" id="uploadContent">
              <div class="plus">+</div>
              <div class="add-text">Add Image or Video</div>
              <div class="add-subtext">Tap to upload media</div>
            </div>
            <button class="remove-btn" id="removeBtn" onclick="removeImage(event)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
                <path d="M18 6L6 18M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="controls">
          <div class="left-icons">
            <div class="icon" title="Privacy">üîí</div>
            <div class="icon" title="Location">üìç</div>
            <div class="icon" title="Tag">üè∑Ô∏è</div>
          </div>
          <button class="post-btn" onclick="handlePost()">Post</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Exit Confirmation Modal -->
  <div class="modal-overlay" id="exitModal">
    <div class="modal">
      <div class="modal-title">Discard Post?</div>
      <div class="modal-message">Are you sure you want to leave? Your post will not be saved.</div>
      <div class="modal-actions">
        <button class="modal-btn cancel" onclick="closeExitModal()">Continue Editing</button>
        <button class="modal-btn confirm" onclick="confirmExit()">Discard</button>
      </div>
    </div>
  </div>

 <script>
    // Global variable to store selected file
    let selectedFile = null;
    const token = localStorage.getItem("token");
    
    function autoResize(textarea) {
      textarea.style.height = '44px';
      textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
    }
    
    async function handleFileSelect(event) {
      const file = event.target.files[0];
      
      if (file && file.type.startsWith('image/')) {
        // Store file globally
        selectedFile = file;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const previewImage = document.getElementById('previewImage');
          const uploadContent = document.getElementById('uploadContent');
          const addBox = document.getElementById('addBox');
          const removeBtn = document.getElementById('removeBtn');
          const fileInput = document.getElementById('fileInput');
          
          previewImage.src = e.target.result;
          previewImage.classList.add('show');
          uploadContent.classList.add('hide');
          addBox.classList.add('has-image');
          removeBtn.classList.add('show');
          fileInput.classList.remove('active');
        };
        reader.readAsDataURL(file);
      }
    }
    
    function removeImage(event) {
      event.stopPropagation();
      event.preventDefault();
      
      const previewImage = document.getElementById('previewImage');
      const uploadContent = document.getElementById('uploadContent');
      const addBox = document.getElementById('addBox');
      const removeBtn = document.getElementById('removeBtn');
      const fileInput = document.getElementById('fileInput');
      
      previewImage.src = '';
      previewImage.classList.remove('show');
      uploadContent.classList.remove('hide');
      addBox.classList.remove('has-image');
      removeBtn.classList.remove('show');
      fileInput.value = '';
      fileInput.classList.add('active');
      
      // Clear stored file
      selectedFile = null;
    }
    
    async function handlePost() {
      const textarea = document.getElementById('autoExpand');
      const postText = textarea.value.trim();
      
      // Create FormData
      const formData = new FormData();
      formData.append('text', postText);
      
      if (selectedFile) {
        formData.append('image', selectedFile);
      }
      
      try {
        const postBtn = document.querySelector('.post-btn');
        postBtn.textContent = 'Posting...';
        postBtn.disabled = true;
        
        const res = await fetch("http://localhost:2345/api/posts", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`, // send token to backend
        },
        body: formData
      });
        
        const data = await res.json();
        
        if (res.ok) {
          alert('Post created successfully!');
          window.location.href = 'clients.html';
          resetForm();
        } else {
          throw new Error(data.message || 'Failed to create post');
        }
        
      } catch (error) {
        console.error('Error:', error);
      } finally {
        const postBtn = document.querySelector('.post-btn');
        postBtn.textContent = 'Post';
        postBtn.disabled = false;
      }
    }
    
    function resetForm() {
      const textarea = document.getElementById('autoExpand');
      textarea.value = '';
      textarea.style.height = '44px';
      
      if (selectedFile) {
        const fakeEvent = { 
          stopPropagation: () => {}, 
          preventDefault: () => {} 
        };
        removeImage(fakeEvent);
      }
    }
    
    function showExitModal() {
      document.getElementById('exitModal').classList.add('show');
    }
    
    function closeExitModal() {
      document.getElementById('exitModal').classList.remove('show');
    }
    
    function confirmExit() {
      closeExitModal();
      window.history.back()
    }
    
    document.getElementById('exitModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeExitModal();
      }
    });
</script>
</body>
</html>