<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="./images/icon.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <title>WordLink</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@500;700&family=Poppins:wght@500;600&display=swap');

      :root{
        --bg: #ffffff;
        --muted: #f1f5f9;
        --accent: #0A84FF;
        --accent-hover: #0070e0;
        --text: #0f172a;
        --text-muted: #64748b;
        --border: rgba(15,23,42,0.08);
        --glow: rgba(10,132,255,0.15);
        font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      
      body {
        font-family: 'Inter', sans-serif;
        user-select: none;
        margin: 0;
        overflow-y: auto;
        padding: 0;
        background-color: white
      }

      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0px;
        height: 50px;
        z-index: 1000;
        padding: 10px 20px;
        background-color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }

      svg {
        width: 30px;
        height: 30px;
        font-weight: bold;
      }

      #post-icon {
        color: #4169e1;
      }

      p {
        font-weight: 400;
        font-family: 'Inter', sans-serif;
        font-size: 14px;
        color: #333;
        margin: 10px 0;
      }

      .home-title {
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
        font-size: 22px;
        margin: 15px 20px;
      }

      .post-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 0 20px;
      }

      .post-container textarea {
        border: none;
        resize: none;
        font-size: 14px;
        font-family: 'Inter', sans-serif;
        background-color: rgba(135, 206, 250, 0.2);
        outline: none;
        border-radius: 5px;
        box-sizing: border-box;
        padding: 15px 10px;
      }

      .post-container textarea:hover {
        outline: 2px solid #000;
      }
      
      .home-title2{
        display: flex;
        flex-direction: row;
        gap: 10px;
        align-items: center;
      }
      
      .home-title2 img{
        max-width: 90px;
        margin-left: 25px;
      }

      .post-container button {
        width: 70px;
        text-align: center;
        color: white;
        
        border: none;
        background: linear-gradient(90deg, #6a5acd, #4169e1);
        padding: 7px 10px;
        border-radius: 6px;
        align-self: flex-end;
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
        font-weight: 500;
        transition: 0.3s ease;
      }

      .post-container button:hover {
        opacity: 0.9;
        transform: scale(1.03);
      }

      .post-container button:active {
        background: linear-gradient(90deg, #483d8b, #1e90ff);
        transform: scale(0.97);
      }

      .seperator {
        height: 1px;
        width: 100%;
        background-color: #e0e0e0;
        margin: 10px 5px;
      }

      .post-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
      }

      .post-card {
        margin-top: 5px;
        display: flex;
        flex-direction: column;
        padding: 5px 15px;
        border-radius: 8px;
        font-family: 'Inter', sans-serif;
      }


      .post-card:first-of-type{
        margin-top: 20px;
      }

      .post-date{
        font-size: 12px;
        color: grey;
        text-align: right;
        margin-top: 5px;
      }

      .post-content{
         display: -webkit-box;        /* Needed for line clamping */
        -webkit-line-clamp: 3;       /* Number of lines to show */
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .post-card:active:not(:has(button:active, svg:active, span:active)) {
        background-color: #dcdcdc;
    }

      .post-header {
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: space-between;
      }

      .post-profile {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .post-profile img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
      }

      .post-text {
        display: flex;
        flex-direction: column;
        gap: 2px;
        font-size: 13px;
      }

      .post-text span:first-of-type {
        font-weight: 600;
        font-family: 'Montserrat', sans-serif;
      }

      .post-text span:last-of-type {
        color: grey;
        font-family: 'Inter', sans-serif;
      }

      .content {
        margin-top: 30px;
        font-size: 14px;
        overflow: hidden;
        line-height: 1.5;
        font-family: 'Inter', sans-serif;
        color: #333;
      }

      img {
        box-sizing: border-box;
        max-width: 100%;
      }

      svg {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        transition: transform 0.1s ease;
      }

      svg:active {
        transform: scale(0.9);
        color: rgba(40, 40, 171, 0.749)
      }

      svg:hover {
        color: #0A84FF;
      }

      .post-tail {
        display: flex;
        align-items: center;
        gap: 2px;
        margin-top: 10px;
      }

      .post-tail svg {
        font-size: 20px;
        width: 1em;
        height: 1em;
      }

      .post-tail span {
        font-size: 12px;
        font-family: 'Inter', sans-serif;
      }
      
      .post-tail span:not(:last-child) {
      margin-right: 8px; /* adds spacing between spans except the last one */
    }

      .sidebar {
        display: flex;
        flex-direction: column;/* align items to the left */
        justify-content: flex-start;
        padding: 20px 0; /* add a bit of vertical spacing */
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100%;
        background-color: #fff;
        z-index: 10000;
        transition: transform 0.3s ease;
        transform: translateX(-100%);
        overflow-y: auto; /* ensures long lists can scroll */
    }
      
      #menu-icon {
        position: absolute;
        top: 5px;
        left: 10px;
        border-radius: 50%;
        background-color: #fff;
        cursor: pointer;
        padding: 5px;
        transition: left 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        z-index: 1100;
        height: 1em;
        width: 1em;
        font-size: 40px;
    }

    /* When sidebar opens, move the menu icon right */
    .sidebar.active ~ div nav #menu-icon {
      left: 260px; /* sidebar width + gap */
      transform: rotate(90deg);
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

      .sidebar.active {
        transform: translateX(0);
      }
      
      .sidebar-profile{
        padding: 10px 20px;
      }
      
      .sidebar ul {
        list-style-type: none;
        display: flex;
        flex-direction: column;
        width: 100%;
        padding: 0;
        margin: 0;
    }

      .sidebar li {
        font-size: 20px; /* Increased from 15px */
        font-weight: 700; /* Makes text bold */
        font-family: 'Montserrat', sans-serif; /* A better font for bold UI elements */
        width: 100%;
        padding: 20px 25px;
        display: flex;
        align-items: center;
        gap: 15px; /* Increased gap slightly for better spacing */
        cursor: pointer;
        transition: background 0.2s ease;
        color: #333; /* Ensures text is dark enough to be read clearly */
      }

      li:hover {
        background-color: #f0f0f0;
      }
      
      .sidebar-profile img{
        width: 70px;
        height: 70px;
        border-radius: 50%;
        margin-bottom: 10px;
      }

      .dropdown {
        position: relative;
        display: inline-block;
        width: fit-content;
      }
      
      li svg {
        height: 1em;
        width: 1em;
        font-size: 24px; /* Make icons slightly larger than the text */
      }
      
      .sidebar-profile p{
        font-size: 16px;
        border: 5px;
      }
      
      .readmore{
        border: 0;
        font-size: 15px;
        outline: 0;
        text-decoration: underline;
        background: none;
        color: #0A84FF;
        padding: 2px;
      }
      
      .sidebar-profile p:first-of-type {
        font-weight: 600;
        white-space: nowrap;      /* Prevents the text from wrapping to a new line */
        overflow: hidden;         /* Hides the overflowing text */
        text-overflow: ellipsis;  /* Displays the ellipsis (...) for the clipped text */
        max-width: 200px;  
        font-family: 'Montserrat', sans-serif;
      }

      .sidebar-profile p:last-of-type {
        color: grey;
        white-space: nowrap;      /* Prevents the text from wrapping to a new line */
        overflow: hidden;         /* Hides the overflowing text */
        text-overflow: ellipsis;  /* Displays the ellipsis (...) for the clipped text */
        max-width: 200px;  
        font-family: 'Inter', sans-serif;
      }

      .dropdown-toggle {
      cursor: pointer;
    }


      
      /* Container for the stats row */
    .follow {
      display: flex;
      padding: 15px 0; /* Add vertical breathing room */
      gap: 30px; /* Space between "Following" and "Followers" groups */
      border-bottom: 1px solid var(--border); /* Optional: adds a subtle divider line below stats */
      margin-bottom: 10px;
    }

    /* Individual stat block (e.g., the whole "Following 20" group) */
    .follows {
      display: flex;
      flex-direction: column; /* Stack number on top of label */
      align-items: flex-start; /* Align text to the left (cleaner) */
      font-family: 'Inter', sans-serif;
      cursor: pointer; /* Suggests these are clickable */
    }

    /* The Label (e.g., "Following") */
    .follows span:first-of-type {
      font-size: 13px;
      color: var(--text-muted); /* Use your muted variable or #64748b */
      font-weight: 500;
      text-transform: capitalize;
    }

    /* The Number (e.g., "54") */
    .follows span:last-of-type {
      font-size: 18px; /* Make the number pop */
      font-weight: 700; /* Bold */
      color: var(--text); /* Dark/Black */
      line-height: 1.2;
      margin-top: 2px;
    }

    /* Hover effect for interactivity */
    .follows:hover span:last-of-type {
      text-decoration: underline;
      color: var(--accent);
    }

      .post-image{
        /* Spacing: Adds margin to separate the image from the text/tail. */
        margin-top: 10px; /* Space above image */
        margin-bottom: 5px; /* Space below image */

        /* Dimensions & Fit: Keeps image responsive but prevents excessive size. */
        width: 100%;
        height: auto;
        max-height: 500px; 
        
        /* Visual: Ensures clean edges and a subtle shadow. */
        border: 1px solid #e0e0e0; /* Add a very light border for definition */
        outline: 0;
        border-radius: 12px; /* Slightly less aggressive border radius than 18px */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow for depth */
        /* Positioning: Controls how the image content fills the container. */
        object-fit: cover;
        object-position: center;
      }

      .sidebar-notlogin{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        gap: 15px;
        padding: 20px;
      }

      .sidebar-notlogin button{
        padding: 10px 20px;
        background-color: #1e90ff;
        border: none;
        font-weight: 500;
        color: white;
        outline: none;
        border-radius: 10px;
      }

      .sidebar-notlogin button:hover{
        opacity: 0.9;
        background-color: #0A84FF;
        transform: scale(1.03);
      }

      .sidebar-notlogin button:active{
        background-color: #0066cc;
        transform: scale(0.97);
      }

      .content-box{
        display: none;
      }

      .dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        font-size: 14px;
        background-color: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border-radius: 5px;
        overflow: hidden;
        z-index: 100;
      }

      .dropdown-menu li:hover{
        background-color: #878383;
      }
      .custom-box-overlay{
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
        display:none;
        align-items:center;
        justify-content:center;
        z-index: 10000;
        animation:fadeIn 0.2s ease;
      }
      
      .custom-box-overlay.show{
        display:flex;
      }
      
      @keyframes fadeIn{
        from{opacity:0}
        to{opacity:1}
      }
      
      .custom-box{
        background:var(--bg);
        border-radius:20px;
        padding:28px;
        max-width:400px;
        width:90%;
        box-shadow:0 20px 60px rgba(0,0,0,0.3);
        animation:slideUp 0.3s ease;
      }
      
      @keyframes slideUp{
        from{transform:translateY(20px);opacity:0}
        to{transform:translateY(0);opacity:1}
      }
      
      .custom-box-title{
        font-size:18px;
        font-weight:700;
        color:var(--text);
        margin-bottom:12px;
      }
      
      .custom-box-message{
        font-size:14px;
        color:var(--text-muted);
        margin-bottom:24px;
        line-height:1.6;
      }
      
      .custom-box-actions{
        display:flex;
        gap:12px;
      }
      
      .custom-box-btn{
        flex:1;
        padding:12px 20px;
        border-radius:12px;
        font-weight:600;
        font-size:14px;
        cursor:pointer;
        transition:all 0.2s;
        border:none;
      }
      
      .custom-box-btn.cancel{
        background:var(--muted);
        color:var(--text);
      }
      
      .custom-box-btn.cancel:hover{
        background:#e2e8f0;
      }
      
      .custom-box-btn.confirm{
        background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color:#fff;
        box-shadow:0 8px 20px rgba(239,68,68,0.25);
      }
      
      .custom-box-btn.confirm:hover{
        transform:translateY(-2px);
        box-shadow:0 12px 28px rgba(239,68,68,0.35);
      }

      #like-btn.liked {
            fill: #ef4444; /* Red for liked state */
            stroke: #ef4444;
        }
        #like-btn:hover {
             fill: #fca5a5; /* Lighter red on hover */
             stroke: #fca5a5;
        }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.9);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 20000;
      }

      .loading-w {
        font-size: 80px;
        font-weight: 900;
        color: #0A84FF;
        font-family: 'Montserrat', sans-serif;
        animation: fadeDisperse 1.5s infinite;
      }

      @keyframes fadeDisperse {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.3; transform: scale(1.1); }
        100% { opacity: 1; transform: scale(1); }
      }

    @media (min-width: 760px) {
      body{
        display: grid;
        overflow: hidden;
        grid-template-columns: 250px 1fr; 
        height: 100vh; /* Make body fill the viewport */
        width: 100%;
        margin: 0;
      }

      .content-box {
        display: none;
      }

      .sidebar {
        position: sticky; 
        top: 0;
        height: 100vh;
        transform: translateX(0);
        z-index: 10;
        border-right: 1px solid #e0e0e0;
      }

      
      #menu-icon {
        display: none;
      }
      
      /* 3. MAIN CONTENT: Scrollable, takes up the middle 1fr column */
      .post-home { 
        height: 100vh;
        scrollbar-color: rgb(112, 109, 109) transparent; /* For Firefox */
        flex: 1;
        right: 0;
        padding: 0; /* Remove horizontal padding from here */
        position: relative;
        max-width: none; /* Let the 1fr column control width */
        overflow-y: auto; /* Ensures scrollable feed */
        min-width: 400px; /* Prevents center column from collapsing too much */
      }
      
      /* 4. NAVBAR: Ensure it spans the full width of the scrollable column */
      nav {
        position: sticky; /* Keep navigation visible at the top */
        top: 0;
        width: 100%; /* Spans the full width of the .post-home container */
        padding: 10px 20px; /* Restore standard padding */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Ensure shadow is on top */
      }
    }

      

      

      /* Laptop and up (1024px) */
    /* Laptop and up (1024px) */
@media (min-width: 1024px) {
  /* 1. MAIN LAYOUT: Establishes the three-column structure */
  body {
    display: grid;
    overflow: hidden;
    grid-template-columns: 250px 1fr 350px; 
    height: 100vh; /* Make body fill the viewport */
    width: 100%;
    margin: 0;
  }
  
  /* 2. SIDEBAR: Fixed position within the grid column */
  .sidebar {
    position: sticky; 
    top: 0;
    height: 100vh;
    transform: translateX(0);
    z-index: 10;
    border-right: 1px solid #e0e0e0;
  }
  
  /* 3. MAIN CONTENT: Scrollable, takes up the middle 1fr column */
  .post-home { 
    height: 100vh;
    scrollbar-color: rgb(112, 109, 109) transparent; /* For Firefox */
    flex: 1;
    padding: 0; /* Remove horizontal padding from here */
    position: relative;
    max-width: none; /* Let the 1fr column control width */
    overflow-y: auto; /* Ensures scrollable feed */
    min-width: 400px; /* Prevents center column from collapsing too much */
  }
  
  /* 4. NAVBAR: Ensure it spans the full width of the scrollable column */
  nav {
    position: sticky; /* Keep navigation visible at the top */
    top: 0;
    width: 100%; /* Spans the full width of the .post-home container */
    padding: 10px 20px; /* Restore standard padding */
    box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Ensure shadow is on top */
  }

  /* 5. RIGHT COLUMN (Placeholder): Fixed position within the grid column */
  .content-box {
    display: flex; /* Makes the placeholder visible */
    position: sticky;
    background: transparent;
    grid-column: 3;
    top: 0;
    right: 0;
    height: 100vh;
    color: grey;
    border-left: 1px solid #e0e0e0;
    align-items: center;
    width: 100%;
    justify-content: center;
    z-index: 1000;
  }

  /* 6. HIDE MOBILE MENU */
  #menu-icon {
    display: none;
  }
}
</style>
  </head>
  <body>
    <aside class="sidebar" id="sidebar">
    </aside>
    <div class="post-home">
      <nav>
        <div class="home-title2">
        <svg
          id="menu-icon"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5M12 17.25h8.25"
          />
        </svg>
        <img src="./images/icon2.png" alt="."/>
        </div>
        
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          id="post-btn"
          style="color: #0A84FF;"
          class="size-6"
        >
          <path
            fill-rule="evenodd"
            d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z"
            clip-rule="evenodd"
          />
        </svg>
      </nav>
      <section class="post-section">
      </section>
    </div>
    <div class="content-box">Nothing to see here...</div>
    <div class="loading-overlay" id="loadingWidget">
      <div class="loading-w">W</div>
    </div>
    <div class="custom-box-overlay" id="logoutModal">
        <div class="custom-box">
          <div class="custom-box-title">Log Out?</div>
          <div class="custom-box-message">Are you sure you want to log out of your account?</div>
          <div class="custom-box-actions">
            <button class="custom-box-btn cancel" onclick="closeLogoutModal()">Cancel</button>
            <button class="custom-box-btn confirm" onclick="confirmLogout()">Log Out</button>
          </div>
        </div>
    </div>
    <div class="custom-box-overlay" id="deleteModal">
        <div class="custom-box">
          <div class="custom-box-title">Delete Post?</div>
          <div class="custom-box-message">Are you sure you want to delete this post? Your will not be able to retrieve it again.</div>
          <div class="custom-box-actions">
            <button class="custom-box-btn cancel" onclick="closedeleteModal()">Cancel</button>
            <button class="custom-box-btn confirm">Delete</button>
          </div>
        </div>
    </div>
  <script>
    const logIn = function(){
        window.location.href = "login.html"
      }
    const postDiv = document.querySelector('.post-section')
    const token = localStorage.getItem('token')
    const sidebar = document.querySelector('.sidebar')
    const menu = document.getElementById('menu-icon')
    const urlParams = new URLSearchParams(window.location.search);
    const postIdParam = urlParams.get('postId');
    const placeholder = document.querySelector('.content-box')
    const loadingWidget = document.getElementById('loadingWidget')

    function showLoading() {
      loadingWidget.style.display = 'flex';
    }

    function hideLoading() {
      loadingWidget.style.display = 'none';
    }

    // Make hideLoading globally accessible
    window.hideLoading = hideLoading;

    // Load post in content-box if postId is in URL
    if (postIdParam && window.innerWidth >= 1024) {
      showLoading();
      placeholder.innerHTML = `<iframe src="postview.html?postId=${postIdParam}" style="width:100%; height:100%; border:none; z-index: 10000" onload="window.hideLoading()"></iframe>`;
    }

    function openPost(event, postId) {
      const target = event.target

  // If the click happened on (or inside) a button, textarea, SVG (icon), or dropdown
    if (target.closest('button') || 
        target.closest('textarea') || 
        target.closest('svg') || 
        target.closest('.dropdown-toggle') ||
        target.closest('.dropdown-menu')) {
        return; // STOP! Do not open the post.
    }else{
      target.style.background = "#f0f0f0"
    }


      if (!postId) return;
      
      sessionStorage.setItem("currentPostId", postId);
      if (window.innerWidth >= 1024) {
        const newUrl = `${window.location.pathname}?postId=${postId}`;
        target.style.background = "transparent"
        window.history.pushState({}, "", newUrl);
        showLoading();
        placeholder.innerHTML = `<iframe src="postview.html?postId=${postId}" style="width:100%; height:100%; border:none; z-index: 10000" onload="window.hideLoading()"></iframe>`;
        return
      }
      showLoading();
      window.location.href = "postview.html?postId=" + postId;
      target.style.background = "transparent"

    }
    

    function sharePost(postId) {
      if (navigator.share) {
        const url = `${window.location.origin}/clients.html?postId=${postId}`
        navigator.share({
          title: "WordLink Post",
          url: url
        })
      } else {
        navigator.clipboard.writeText(url);
        alert("Link copied: " + url);
      }
    }

    document.querySelector('.custom-box-btn.confirm').addEventListener('click', function(){
      const postId = sessionStorage.getItem("deletePostId");
      deletePost(postId);
      closedeleteModal();
    });

    const editPost = (postId) => {
      sessionStorage.setItem("editPostId", postId);
      window.location.href = "editpost.html";
    }

    function showdeleteModal(postId) {
      sessionStorage.setItem("deletePostId", postId);
      document.getElementById('deleteModal').classList.add('show');
    }
    
    function closedeleteModal() {
      document.getElementById('deleteModal').classList.remove('show');
    }

    function closeLogoutModal() {
      document.getElementById('logoutModal').classList.remove('show');
    }

    function showLogoutModal() {
      document.getElementById('logoutModal').classList.add('show');
    }

    function confirmLogout() {
      localStorage.removeItem('token');
      window.location.href = "login.html";
    }
  
    
    document.getElementById('logoutModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeLogoutModal();
      }
    });

    document.getElementById('deleteModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closedeleteModal();
      }
    });

    const deletePost = async (postId) => {

      const res = await fetch(`https://wordlinkapp.onrender.com/api/posts/${postId}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` },
      });

      const data = await res.json();

      if (res.ok) {
        document.querySelector(`[data-id="${postId}"]`).remove();
      } else {
        alert(data.message || "Delete failed");
      }
}


    function getPostScore(post) {
      const hoursSincePost = (new Date() - new Date(post.createdAt)) / 3600000; // hours
      const score = post.likes * 2 + post.comments.length * 3 - hoursSincePost * 0.5;
      // likes and comments increase score, older posts lose score
      return score;
    }

    menu.addEventListener('click', (e) => {
      sidebar.classList.toggle("active")
      if (sidebar.classList.contains("active")){
        menu.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />`
    }else{
      menu.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M12 17.25h8.25" />`
    }})
    const postBtn = document.querySelector("#post-btn")
    postBtn.addEventListener('click', (e) => {
      if (token){
        window.location.href = "post.html"
      }else{
        alert("User not logged in")
      }
    })
    
postDiv.addEventListener('click', async (e) => {
  const btn = e.target.closest('.like-btn');
  if (!btn) return;

  const postCard = btn.closest('.post-card');
  const postId = postCard.dataset.id;
  const likesSpan = postCard.querySelector('.likes');

  if (!token) return alert("You must be logged in to like a post");

  const isLiked = btn.getAttribute("fill") === "red";
  const currentLikes = parseInt(likesSpan.textContent);
  
  btn.setAttribute("fill", !isLiked ? "red" : "none");
  btn.setAttribute("stroke", !isLiked ? "red" : "currentColor");
  likesSpan.textContent = !isLiked ? currentLikes + 1 : currentLikes - 1;

  try {
    await fetch(`https://wordlinkapp.onrender.com/api/posts/${postId}/like`, {
      method: "POST",
      headers: { Authorization: `Bearer ${token}` },
    });
  } catch (err) {
    btn.setAttribute("fill", isLiked ? "red" : "none");
    btn.setAttribute("stroke", isLiked ? "red" : "currentColor");
    likesSpan.textContent = currentLikes;
  }
});
    
    async function createPost() {
      const content = document.getElementById("postContent").value.trim();
      try {
        if (!token) {
           return;
        }

        if (!content || content.trim() === "") {
          return;
         }

      const res = await fetch("https://wordlinkapp.onrender.com/api/posts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`, // send token to backend
        },
        body: JSON.stringify({ content }),
      });

      const data = await res.json();

      if (res.ok) {
        alert("Post created successfully!");
        document.getElementById("postContent").value = "";
        loadTimeline(); // reload posts
      } else {
        alert(data.message || "Failed to create post");
      }
    } catch (err) {
      console.error(err);
      alert("Error while creating post");
    }
  }
    const loadTimeline = async () => {
      showLoading();
      postDiv.innerHTML = ""

const response = await fetch("https://wordlinkapp.onrender.com/api/posts", {
  method: "GET",
  headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
  }
  
});
    const data = await response.json()
    /* posts data include  username fullname content likes createdAt likes comments*/
    if (token){
      const profileRes = await fetch("https://wordlinkapp.onrender.com/api/auths/profile", {
      method: "GET",
      headers: {
          Authorization: `Bearer ${token}`,
  }
  
});
    const profileData = await profileRes.json()
    sidebar.innerHTML = `
      <div class="sidebar-profile" onclick="openProfile()">
       <img src=${profileData.profilePic || "./images/profile1.webp"} alt="."/>
       <p>${profileData.firstname + " " +profileData.lastname}</p>
       <p>@${profileData.username}</p>
       <div class="follow">
        <div class="follows">
          <span>Following </span>
          <span>${profileData.followings.length}</span>
        </div>
        <div class="follows">
          <span>Followers</span>
          <span>${profileData.followers.length}</span>
        </div>
       </div>
     </div>
     <ul>
      <li onclick="openCollections()"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
</svg>
 Collections</li>
      <li onclick="openSavedPosts()"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
</svg>

      Saved Post</li>
      <li onclick="openRetweets()"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
</svg>
      Retweets</li>
      <li onclick="openSettings()"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
</svg>
      Settings</li>
      <li class="logout"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
</svg>
 Log out</li>
     </ul>
     
    `
    sidebar.querySelector(".logout").addEventListener("click", () => {
    showLogoutModal();
    });
    }else{
      sidebar.innerHTML = `<div class="sidebar-notlogin">
      <img src="./images/loginimage.png" alt="."/>
      <button class="login", onclick=logIn()>Click here to login</button>
      </div>`
    }

    if (data){
      const sortedPosts = data
  .map(post => ({ ...post, score: getPostScore(post) }))
  .sort((a, b) => b.score - a.score); // highest score first

    sortedPosts.forEach((posts) => {
      postDiv.innerHTML += `
         <div class="post-card" onclick="openPost(event,'${posts._id}')" data-id=${posts._id}>
            <div class="post-header">
              <div class="post-profile">
                <img src=${posts.profilePic || "./images/profile1.webp "} alt="." />
                <div class="post-text">
                  <span>${posts.fullname}</span>
                  <span>${posts.username}</span>
                </div>
              </div>
              <div class="dropdown">
                <svg class="size-6 dropdown-toggle" - data-bs-toggle="dropdown" aria-expanded="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
                </svg>
                <ul class="dropdown-menu">
                  ${!posts.isUserPost ? `<li><button class="dropdown-item follow-btn" 
                      data-user-id="${posts.userId}" 
                      data-username="${posts.username}">
                      ${posts.isFollowing ? `Unfollow @${posts.username}` : `Follow @${posts.username}`}
                    </button>
                  </li>` : ""}
                  ${posts.isUserPost ? `<li><button class="dropdown-item" type="button" onclick="editPost('${posts._id}')">Edit Post</button></li>` : ""}
                  ${posts.isUserPost ? `<li><button class="dropdown-item w-full text-left text-sm text-red-600 hover:bg-red-50 hover:white" type="button" onclick="showdeleteModal('${posts._id}')">Delete Post</button></li>` : ""}
                </ul>
              </div>


            </div>
            <div class="post-content" style={"margin-top: 10px;"}>
              <span class="content">${posts.content}</span>  
              ${posts.content.length > 300 ? `<button class="readmore">Read More</button>` : ""}
              ${posts.imageUrl ? `<img class="post-image" src="${posts.imageUrl}" alt="image"/>` : ""}
            </div>
            ${posts.updatedAt ? `<div class="post-date">${new Date(posts.updatedAt).toLocaleString()}</div>`: ""}
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div class="post-tail">
                <svg
                class="like-btn size-6"
                stroke="${posts.isLiked ? 'red' : 'currentColor'}"
                fill="${posts.isLiked ? 'red' : 'none'}"
                xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" 
                    stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                    </svg>
                <span class="likes">${posts.likes}</span>
                <svg onclick= "openPost(event,'${posts._id}')" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
                </svg>
                <span class="comments">${posts.comments.length}</span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
                </svg>
                <span class="retweets" id="retweets-${posts._id}">0</span>
              </div>
              <div style="display: flex; gap: 10px;">
                <svg onclick="sharePost('${posts._id}')"style="font-size: 20px; width: 1em;  margin-top: 10px; height: 1em;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z" />
                </svg>
                <svg onclick="bookmarkPost('${posts._id}')" style="font-size: 20px; width: 1em; margin-top: 10px; height: 1em; cursor: pointer;" fill="${posts.isBookmarked ? 'currentColor' : 'none'}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
                </svg>
              </div>
            </div>
            
            <div class="seperator"></div>
          </div>
      `
    })
    }
  }
    loadTimeline()
    
    hideLoading();
    
    function openProfile() {
      const isMobile = window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      if (isMobile) {
        showLoading();
        window.location.href = "profileview.html";
      } else {
        if (window.innerWidth >= 1024) {
          showLoading();
          placeholder.innerHTML = `<iframe src="profileview.html" style="width:100%; height:100%; border:none; z-index: 10000" onload="window.hideLoading()"></iframe>`;
        } else {
          showLoading();
          window.location.href = "profileview.html";
        }
      }
    }

    async function bookmarkPost(postId) {
      const bookmarkIcon = document.querySelector(`svg[onclick="bookmarkPost('${postId}')"]`);
      const isBookmarked = bookmarkIcon.getAttribute('fill') === 'currentColor';
      
      bookmarkIcon.setAttribute('fill', isBookmarked ? 'none' : 'currentColor');
      
      try {
        const res = await fetch(`https://wordlinkapp.onrender.com/api/posts/${postId}/bookmark`, {
          method: 'POST',
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) {
          bookmarkIcon.setAttribute('fill', isBookmarked ? 'currentColor' : 'none');
          alert('Failed to bookmark post');
        }
      } catch (err) {
        bookmarkIcon.setAttribute('fill', isBookmarked ? 'currentColor' : 'none');
        alert('Network error. Please try again.');
      }
    }

    async function retweetPost(postId) {
      const retweetCount = document.getElementById(`retweets-${postId}`);
      const currentCount = parseInt(retweetCount.textContent);
      
      retweetCount.textContent = currentCount + 1;
      
      try {
        const res = await fetch(`https://wordlinkapp.onrender.com/api/posts/${postId}/retweet`, {
          method: 'POST',
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) {
          retweetCount.textContent = currentCount;
          alert('Failed to retweet post');
        }
      } catch (err) {
        retweetCount.textContent = currentCount;
        alert('Network error. Please try again.');
      }
    }

    // Follow functionality
    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('follow-btn')) {
        const btn = e.target;
        const userId = btn.dataset.userId;
        const username = btn.dataset.username;
        
        if (!token) return alert('You must be logged in to follow users');
        
        const isFollowing = btn.textContent.includes('Unfollow');
        btn.textContent = isFollowing ? `Follow @${username}` : `Unfollow @${username}`;
        
        try {
          const res = await fetch(`https://wordlinkapp.onrender.com/api/posts/follow/${userId}`, {
            method: 'POST',
            headers: { Authorization: `Bearer ${token}` }
          });
          
          if (!res.ok) {
            btn.textContent = isFollowing ? `Unfollow @${username}` : `Follow @${username}`;
            alert('Failed to follow/unfollow user');
          }
        } catch (err) {
          btn.textContent = isFollowing ? `Unfollow @${username}` : `Follow @${username}`;
          alert('Network error. Please try again.');
        }
      }
    });

    function openCollections() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        showLoading();
        window.location.href = "profileview.html?tab=collections";
      } else {
        if (window.innerWidth >= 1024) {
          showLoading();
          placeholder.innerHTML = `<iframe src="profileview.html?tab=collections" style="width:100%; height:100%; border:none" onload="window.hideLoading()"></iframe>`;
        } else {
          showLoading();
          window.location.href = "profileview.html?tab=collections";
        }
      }
    }

    function openSavedPosts() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        showLoading();
        window.location.href = "profileview.html?tab=saved";
      } else {
        if (window.innerWidth >= 1024) {
          showLoading();
          placeholder.innerHTML = `<iframe src="profileview.html?tab=saved" style="width:100%; height:100%; border:none" onload="window.hideLoading()"></iframe>`;
        } else {
          showLoading();
          window.location.href = "profileview.html?tab=saved";
        }
      }
    }

    function openRetweets() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        showLoading();
        window.location.href = "profileview.html?tab=retweets";
      } else {
        if (window.innerWidth >= 1024) {
          showLoading();
          placeholder.innerHTML = `<iframe src="profileview.html?tab=retweets" style="width:100%; height:100%; border:none" onload="window.hideLoading()"></iframe>`;
        } else {
          showLoading();
          window.location.href = "profileview.html?tab=retweets";
        }
      }
    }

    function openSettings() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        showLoading();
        window.location.href = "settings.html";
      } else {
        if (window.innerWidth >= 1024) {
          showLoading();
          placeholder.innerHTML = `<iframe src="settings.html" style="width:100%; height:100%; border:none" onload="window.hideLoading()"></iframe>`;
        } else {
          showLoading();
          window.location.href = "settings.html";
        }
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
  </body>
</html>
